<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Provincias Challenge</title>

<script src="https://cdn.tailwindcss.com"></script>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-slate-100">
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect, useMemo } = React;

const GEOJSON_URL =
"https://raw.githubusercontent.com/codeforgermany/click_that_hood/main/public/data/spain-provinces.geojson";

const COMMUNITIES = [
{ id:"andalucia", name:"Andalucía", provinces:["Almería","Cádiz","Córdoba","Granada","Huelva","Jaén","Málaga","Sevilla"]},
{ id:"aragon", name:"Aragón", provinces:["Huesca","Teruel","Zaragoza"]},
{ id:"asturias", name:"Asturias", provinces:["Asturias"]},
{ id:"baleares", name:"Islas Baleares", provinces:["Illes Balears"]},
{ id:"canarias", name:"Canarias", provinces:["Las Palmas","Santa Cruz de Tenerife"]},
{ id:"cantabria", name:"Cantabria", provinces:["Cantabria"]},
{ id:"castilla_la_mancha", name:"Castilla-La Mancha", provinces:["Albacete","Ciudad Real","Cuenca","Guadalajara","Toledo"]},
{ id:"castilla_y_leon", name:"Castilla y León", provinces:["Ávila","Burgos","León","Palencia","Salamanca","Segovia","Soria","Valladolid","Zamora"]},
{ id:"cataluna", name:"Cataluña", provinces:["Barcelona","Girona","Lleida","Tarragona"]},
{ id:"valencia", name:"Comunidad Valenciana", provinces:["Alicante","Castellón","Valencia"]},
{ id:"extremadura", name:"Extremadura", provinces:["Badajoz","Cáceres"]},
{ id:"galicia", name:"Galicia", provinces:["A Coruña","Lugo","Ourense","Pontevedra"]},
{ id:"rioja", name:"La Rioja", provinces:["La Rioja"]},
{ id:"madrid", name:"Madrid", provinces:["Madrid"]},
{ id:"murcia", name:"Murcia", provinces:["Murcia"]},
{ id:"navarra", name:"Navarra", provinces:["Navarra"]},
{ id:"pais_vasco", name:"País Vasco", provinces:["Álava","Bizkaia","Gipuzkoa"]}
];

const COLORS = ["#f59e0b","#ef4444","#22c55e","#06b6d4","#f97316","#84cc16","#eab308","#a855f7","#ec4899","#14b8a6","#65a30d","#0ea5e9","#d946ef","#dc2626","#fb7185","#10b981","#6366f1"];

function renderPath(g){
 if (!g) return "";
 const rings = g.type === 'Polygon' ? [g.coordinates] : g.coordinates;
 return rings.map(p =>
  p.map(r => `M ${r.map(c => c.join(',')).join(' L ')} Z`).join(' ')
 ).join(' ');
}

const normalize = t =>
 t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();

function App(){

 const [geo,setGeo] = useState(null);
 const [done,setDone] = useState([]);
 const [selected,setSelected] = useState(null);
 const [msg,setMsg] = useState("Elige una provincia");

 useEffect(()=>{
  fetch(GEOJSON_URL).then(r=>r.json()).then(setGeo);
 },[]);

 const pending = useMemo(()=>(
  COMMUNITIES.flatMap(c=>c.provinces).filter(p=>!done.includes(p))
 ),[done]);

 function match(a,b){
  return normalize(a).includes(normalize(b)) || normalize(b).includes(normalize(a));
 }

 function clickMap(name){
  if(!selected) return setMsg("Selecciona provincia abajo");
  if(match(name,selected)){
    setDone([...done,selected]);
    setSelected(null);
    setMsg("✔ Correcto");
  } else {
    setMsg("❌ No es esa");
  }
 }

 if(!geo) return <div className="p-10 font-bold">Cargando mapa…</div>;

 return (
 <div className="p-4 space-y-4">

  <h1 className="text-xl font-black">Provincias Challenge</h1>

  <div className="flex flex-wrap gap-2">
   {pending.map(p=>(
    <button key={p}
     onClick={()=>setSelected(p)}
     className={`px-3 py-1 border rounded text-sm font-bold
     ${selected===p?"bg-amber-400":""}`}>
     {p}
    </button>
   ))}
  </div>

  <div className="font-bold">{msg} — {done.length}/50</div>

  <svg viewBox="-11 35 15.5 9.2" className="w-full max-w-3xl border">
   {geo.features.map((f,i)=>{
    const name = f.properties.name;
    const idx = COMMUNITIES.findIndex(c =>
      c.provinces.some(p=>match(name,p))
    );
    const filled = done.some(p=>match(name,p));
    return (
     <path key={i}
      d={renderPath(f.geometry)}
      onClick={()=>clickMap(name)}
      fill={filled ? COLORS[idx % COLORS.length] : "#e5e7eb"}
      stroke="#334155"
      strokeWidth="0.02"
      className="cursor-pointer hover:fill-amber-200"
     />
    );
   })}
  </svg>

 </div>
 );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>

